{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
    /* style.css */
/* Custom styles for Products List page */

/* Breadcrumbs */
.sub-header {
    background-color: #f0f0f0;
    border-radius: 5px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

/* Subcategory Navigation */
.card {
    margin-bottom: 20px;
    border: 1px solid #f0f0f0;
    border-radius: 5px;
}

.nav-pills .nav-link {
    color: #333;
    background-color: #f8f8f8;
    border: 1px solid #f0f0f0;
    border-radius: 5px;
    margin-right: 5px;
    transition: all 0.2s;
}

.nav-pills .nav-link.active,
.nav-pills .nav-link:hover {
    background-color: #007bff;
    color: #fff;
}

/* Items Display */
#items-container {
    display: flex;
    flex-wrap: wrap;
}

#items-container .col-md-6 {
    transition: transform 0.2s;
}

#items-container .col-md-6:hover {
    transform: translateY(-5px);
}

.caption-bg {
    background-color: rgba(255, 255, 255, 0.8);
}

.caption-bg .d-table {
    height: 100%;
}

.caption-bg .d-table-cell {
    vertical-align: bottom;
}

.caption-bg a {
    color: #333;
}

.caption-bg a:hover {
    color: #007bff;
}

/* Pagination */
.pagination {
    margin-top: 20px;
}

.pagination .page-item.disabled .page-link {
    color: #aaa;
}

.pagination .page-item.active .page-link {
    background-color: #007bff;
    border-color: #007bff;
}

</style>
<main>
    <div class="container-fluid site-width">
        <!-- START: Breadcrumbs-->
        <div class="row">
            <div class="col-12 align-self-center">
                <div class="sub-header mt-3 py-3 align-self-center d-sm-flex w-100 rounded">
                    <div class="w-sm-100 mr-auto">
                        <h4 class="mb-0">Products List</h4>
                    </div>

                    <ol class="breadcrumb bg-transparent align-self-center m-0 p-0">
                        <li class="breadcrumb-item">Home</li>
                        <li class="breadcrumb-item">Product</li>
                        <li class="breadcrumb-item active">
                            <a href="#">Products List</a>
                        </li>
                    </ol>
                </div>
            </div>
        </div>

<!-- Items Display -->
<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mt-4" id="items-container">
    {% for item in items %}
    <div class="bg-white rounded-lg shadow-lg p-4">
        <div class="relative mb-4">
            <img src="{{ item.image.url }}" alt="{{ item.name }}" class="w-full h-48 object-cover rounded-md">
            <div class="caption-bg fade bg-transparent text-right absolute top-0 right-0">
                <div class="d-table w-100 h-100 ">
                    <div class="d-table-cell align-bottom">
                        <div class="mb-3">
                            <a href="#" class="rounded-left bg-white px-3 py-2 shadow2"><i class="icon-heart"></i></a>
                        </div>
                        <div class="mb-4">
                            <a href="#" class="rounded-left bg-white px-3 py-2 shadow2"><i class="icon-bag"></i></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="pt-3">
            <p class="mb-2"><a href="#" class="font-weight-bold text-primary">{{ item }}</a></p>
            <div class="d-inline-block">Category: {{ item.subcategory.category.name }}</div> <!-- Show the category name -->
            <div class="clearfix">
                <div class="d-inline-block">KES.{{ item.price }}</div>
            </div>
            <div class="d-inline-block">{{ item.quantity }}</div>

            <div class="mt-2">
                {% if item.in_stock %}
                <span class="badge badge-primary">In Stock</span>
                {% else %}
                <span class="badge badge-danger">Out of Stock</span>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>

    </div>
</main>

<script src="{% static 'js/jquery.min.js' %}"></script>
<script>
    $(document).ready(function() {
        // Event listener for subcategory links
        $('.nav-link').on('click', function(e) {
            e.preventDefault();
            var subcategoryId = $(this).data('subcategory-id');
            loadItemsBySubcategory(subcategoryId);
        });

        // Function to fetch items by subcategory using AJAX
        function loadItemsBySubcategory(subcategoryId) {
            $.ajax({
                url: '/get_items_by_subcategory/' + subcategoryId + '/',
                type: 'GET',
                dataType: 'json',
                success: function(response) {
                    displayItems(response.items);
                },
                error: function(error) {
                    console.error('Error fetching items:', error);
                }
            });
        }

        // Function to update the items container with the fetched items
        function displayItems(items) {
            var itemsContainer = $('#items-container');
            itemsContainer.empty();

            $.each(items, function(index, item) {
                var itemHtml = `
                    <div class="col-md-6 col-lg-3 mb-4">
                        <div class="position-relative">
                            <img src="${item.image}" alt="${item.name}" class="img-fluid">
                            <!-- ... The rest of your item card content ... -->
                        </div>
                        <div class="pt-3">
                            <!-- ... The rest of your item card content ... -->
                        </div>
                    </div>
                `;
                itemsContainer.append(itemHtml);
            });
        }
    });
</script>

{% endblock %}